---
title: "Recovering a True Model"
output: 
  html_document:
    theme: cerulean
    code_folding: hide
---

```{r, message=FALSE, warning=FALSE}
setwd("./Math_425_Project_Data")
p1Data <- read.csv("data/p1Data.csv", header=TRUE)
p2Data <- read.csv("data/p2Data.csv", header=TRUE)
p3Data <- read.csv("data/p3Data.csv", header=TRUE)
```



```{r}
pairs(p1Data)

lm4 <- lm(Y ~ X4, p1Data)

plot(lm4, which = 1)
summary(lm4)
pairs(cbind(R=lm4$res, fit=lm4$fitted, p1Data))

lm42 <- lm(Y ~ X4 + X2, p1Data)
summary(lm42)
pairs(cbind(R=lm42$res, fit=lm42$fitted, p1Data))

plot(Y~X4, data = p1Data, col = factor(X2))

pairs(cbind(R=lm42$res, fit=lm42$fitted, p1Data, I=interaction(p1Data$X2, p1Data$X4)))

lm4242 <- lm(Y ~ X4 + X2 + X4:X2, p1Data)
summary(lm4242)

lm442 <- lm(Y ~ X4 + X4:X2, p1Data)
summary(lm442)

plot(Y~X4, data = p1Data, col = factor(X2))
abline(lm442$coef[1], lm442$coef[2], lwd = 2)
abline(lm442$coef[1], lm442$coef[2] + lm442$coef[3], lwd = 2)

abline(lm4242$coef[1], lm4242$coef[2], col = "olivedrab")
abline(lm4242$coef[1] + lm4242$coef[3], lm4242$coef[2] + lm4242$coef[4], col = "olivedrab")
```

## Part 1 - Recovering a True Model (Beginner Level)

We believe the true model to be...

$$
  Y_i = \underbrace{\beta_0 + \beta_1 X_{4i} + \beta_2 X_{2i}X_{4i}}_\text{The True Model} + \epsilon_i
$$

And estimate that model by...

$$
  \hat{Y}_i = -0.7065 + 2.3958X_{4i} + 1.7763X_{2i}X_{4i}
$$

with our estimate of $\sigma$ as ...

```{r}
sqrt(sum(lm442$res^2)/47)
# = 13.10531 = Residual standard error: 13.11 on 47 degrees of freedom

#confidence interval
confint(lm442)

## This doesn't work because the groups must be separated.
# confbounds <- data.frame(predict(lm442, interval = "confidence"))
# lines(lm442$fitted.values, confbounds$lwr)
# lines(lm442$fitted.values, confbounds$upr)
```


## Part 2 - Recovering a True Model (Intermediate Level)

We believe the true model to be...

```{r}
View(p2Data)
pairs(p2Data)
```

```{r}
lm3 <- lm(Y ~ X3, p2Data)

lm5 <- lm(Y ~ X5, p2Data)

# not helpful because can tell lm5 is not a tranformation boxCox(lm5)
lm05 <- lm(1/Y ~ X5, p2Data)
plot(lm05, which = 1)
summary(lm05)

lm_better <- lm(Y~X5+I(X5^2), p2Data)
summary(lm_better)
plot(lm_better, which = 1)

cor(p2Data)

pairs(cbind(R=lm_better$res, fit=lm_better$fit, p2Data))

lm_wow <- lm(formula = Y ~ X5 + I(X5^2) + X3, data = p2Data)

summary(lm_wow) # note this is fake data. It looks too good.

confint(lm_wow)
```

$$
  Y_i = \underbrace{\beta_0 + \beta_1X_i + \beta_2{X_i}^2}_\text{The True Model} + \epsilon_i
$$

And estimate that model by...

$$
  \hat{Y}_i = 217.761 + 7.397X_i + 1.736{X_i}^2
$$

with our estimate of $\sigma$ as ...

```{r}
14.97

confint(lm_better)
```



## Part 3 - Recovering a True Model (Advanced Level)

```{r}
pairs(p3Data, panel = panel.smooth, col = p3Data$X6 + 3)

abs(cor(p3Data)[,1])
# X6 X8 X12 X9 X20

lm1 <- lm(Y ~ X8 + X6,data = p3Data)
summary(lm1)
pairs(cbind(R=lm1$res, Fit=lm1$fit, p3Data), col = p3Data$X6 + 3)

lm2 <- lm(Y ~ X8 + X6 + X12,data = p3Data)
pairs(cbind(R=lm2$res, Fit=lm2$fit, p3Data), col = p3Data$X6 + 3)
summary(lm2) # lm1 was better.

lm3 <- lm(Y ~ X8 + X6 +X6:X8,data = p3Data)
pairs(cbind(R = lm3$res, Fit = lm3$fit, p3Data), col = p3Data$X6 + 3, panel = panel.smooth)
summary(lm3)
# I think I've found what I can, but lets test some more:
summary(lm(Y ~ X6 + X6:X8,data = p3Data))
summary(lm(Y ~ X8 + X6:X8,data = p3Data)) # <-- this one is better.

plot(Y ~ X8, col = X6 + 3, data = p3Data)
abline(lm3$coef[1], lm3$coef[2])
abline(lm3$coef[1] + lm3$coef[3], lm3$coef[2]+lm3$coef[4])

plot(lm3, which = 1)

summary(lm(lm3$res ~ p3Data$X12)) # nope.

library(tidyverse)

plot(Y ~ X8, col = X6 + 3, data = filter(p3Data, X6 == 1))
plot(Y ~ X8, col = X6 + 3, data = filter(p3Data, X6 == 0)) # X8 == 0 is not explaining the data.

lm4 <- lm(Y ~ X6 + X6:X8,data = p3Data)

lm5 <- lm(Y^0.5 ~ X8, data = filter(p3Data, X6 == 1))
plot(Y^0.5 ~ X8, col = X6 + 3, data = filter(p3Data, X6 == 1))
abline(lm5$coef[1], lm5$coef[2])
plot(Y ~ X8, col = X6 + 3, data = filter(p3Data, X6 == 1))
curve((lm5$coef[1] + lm5$coef[2]*x)^2, add= T)


library(car)
boxCox(lm5)

data1 <- filter(p3Data, X6 == 1)
data0 <- filter(p3Data, X6 == 0)

lm6 <- lm(Y ~ X8 + X11 + X11:X8, data = data1)
summary(lm6)

lm7 <- lm(Y ~ X8 + X8:X6 + X11:X6 + X11:X8:X6 + X2:X6 + X18:X6 + X2:X18:X6 + X2:X8:X6 + X11:X18:X6 + X2 + X3 + X11 + X14, data = p3Data)
summary(lm7)

pairs(cbind(R = lm7$res, Fit = lm7$fit, p3Data), panel = panel.smooth, col = p3Data$X18 + 3)
# cor(cbind(R = lm7$res, Fit = lm7$fit, p3Data))[,1:3]
# 
# pairs(data0, panel = panel.smooth)
# 
# 
# lm8 <- lm(Y ~ X2 + X3 + X11 + X14, data = data0)
# summary(lm8)
# 
# cor(cbind(R = lm8$res, Fit = lm8$fit, data0))[,1:3]
# 
# pairs(cbind(R = lm8$res, Fit = lm8$fit, data0), panel = panel.smooth)
# 
# lm07 <- lm(Y ~ X8 + X6:X8 + X2, data = data0)


```

We believe the true model to be...

$$
  Y_i = \underbrace{\beta_0 + \beta_1X8_i + \beta_2X2_i + \beta_3X3_i + \beta_4X11_i + \beta_5X14_i + \beta_6X8_iX6_i + \beta_7 X6_i X11_i + \beta_8 X6_iX2_i + \beta_9 X6_iX18_i + \beta_{10} X8_iX6_iX11_i + \beta_{11} X6_iX2_iX18_i + \beta_{12} X8_iX6_iX2_i + \beta{13} X6_iX11_iX18_i}_\text{The True Model} + \epsilon_i
$$

And estimate that model by...

$$
  \hat{Y}_i = 1.416171 + 0.159039X8_i + 0.498984X2_i + 0.055452X3_i + 0.641433X11_i - 0.001627X14_i + 1.526135X8_iX6_i + 5.727606 X6_i X11_i -0.112285 X6_iX2_i + 0.234796 X6_iX18_i -1.529489 X8_iX6_iX11_i + 0.115334 X6_iX2_iX18_i -0.708561 X8_iX6_iX2_i + -2.039113 X6_iX11_iX18_i
$$

with our estimate of $\sigma$ as ...

```{r}
1.595

confint(lm7)
```
